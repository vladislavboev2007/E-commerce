<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–Ω–∞—è - E-Commerce Store</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/common.js"></script>
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">E-Store</div>
            <ul class="nav-links">
                <li><a href="/" class="active">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="/products">–¢–æ–≤–∞—Ä—ã</a></li>
                <li><a href="/bundles">–ù–∞–±–æ—Ä—ã</a></li>
                <li><a href="/cart">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
                <li><a href="/orders">–ó–∞–∫–∞–∑—ã</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <!-- Hero Section -->
        <section class="hero card" style="text-align: center; padding: 3rem;">
            <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω</h1>
            <p style="font-size: 1.2rem; margin-bottom: 2rem; color: #666;">
                –õ—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            </p>
            <a href="/products" class="btn" style="font-size: 1.2rem; padding: 1rem 2rem;">
                –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏
            </a>
        </section>

        <!-- Features Section -->
        <section style="margin: 3rem 0;">
            <h2 style="text-align: center; margin-bottom: 2rem;">–ù–∞—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</h2>
            <div class="grid grid-3">
                <div class="card" style="text-align: center;">
                    <h3>üõ°Ô∏è –ê–¥–∞–ø—Ç–µ—Ä—ã</h3>
                    <p>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –∏ —Å–ª—É–∂–±–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>üéÅ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã</h3>
                    <p>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏: —É–ø–∞–∫–æ–≤–∫–∞, –¥–æ—Å—Ç–∞–≤–∫–∞, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è</p>
                </div>
                <div class="card" style="text-align: center;">
                    <h3>üì¶ –ö–æ–º–ø–æ–Ω–æ–≤—â–∏–∫</h3>
                    <p>–ì–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º —Ü–µ–Ω–∞–º</p>
                </div>
            </div>
        </section>

        <!-- Popular Products -->
        <section style="margin: 3rem 0;">
            <h2 style="margin-bottom: 2rem;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h2>
            <div id="popular-products" class="grid grid-4">
                <div class="spinner"></div>
            </div>
        </section>

        <!-- Categories -->
        <section style="margin: 3rem 0;">
            <h2 style="margin-bottom: 2rem;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
            <div id="categories" class="grid grid-3">
                <div class="spinner"></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 E-Commerce Store. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            <p>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤: –ê–¥–∞–ø—Ç–µ—Ä, –î–µ–∫–æ—Ä–∞—Ç–æ—Ä, –ö–æ–º–ø–æ–Ω–æ–≤—â–∏–∫</p>
        </div>
    </footer>

    <script>
    // –£–î–ê–õ–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£: // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è API call
    async function apiCall(endpoint, options = {}) {
        try {
            console.log(`API Call: ${API_BASE}${endpoint}`);
            const response = await fetch(`${API_BASE}${endpoint}`, {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            console.log(`API Response from ${endpoint}:`, data);
            return data;
        } catch (error) {
            console.error('API call failed:', error);
            showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö', 'error');
            return null;
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    async function loadPopularProducts() {
        const container = document.getElementById('popular-products');

        try {
            const products = await apiCall('/products/?limit=4');

            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                        <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å init_data.py –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';

            products.forEach(product => {
                const productCard = `
                    <div class="card">
                        <div style="height: 100px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; border-radius: 8px;">
                            <span style="font-size: 2rem;">üì±</span>
                        </div>
                        <h3>${product.name}</h3>
                        <p class="price">$${product.price}</p>
                        <p style="color: #666; margin: 0.5rem 0; font-size: 0.9rem;">${product.category_name}</p>
                        <p style="font-size: 0.8rem; margin: 0.5rem 0; color: #888;">${product.description.substring(0, 60)}...</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            <button class="btn" onclick="viewProduct(${product.id})">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                            <button class="btn btn-success" onclick="addToCart(${product.id})">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                        </div>
                    </div>
                `;
                container.innerHTML += productCard;
            });
        } catch (error) {
            console.error('Failed to load products:', error);
            container.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</h3>
                    <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π</p>
                </div>
            `;
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    async function loadCategories() {
        const container = document.getElementById('categories');

        try {
            const categories = await apiCall('/categories/');

            if (!categories || categories.length === 0) {
                container.innerHTML = '<p>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            container.innerHTML = '';

            categories.forEach(category => {
                const icons = {
                    'Electronics': 'üíª',
                    'Clothing': 'üëï',
                    'Home Appliances': 'üè†'
                };

                const categoryCard = `
                    <div class="card" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">${icons[category.name] || 'üì¶'}</div>
                        <h3>${category.name}</h3>
                        <button class="btn btn-secondary" onclick="viewCategory(${category.id})">
                            –°–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã
                        </button>
                    </div>
                `;
                container.innerHTML += categoryCard;
            });
        } catch (error) {
            console.error('Failed to load categories:', error);
            container.innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>';
        }
    }

    function viewProduct(productId) {
        window.location.href = `/product?id=${productId}`;
    }

    function viewCategory(categoryId) {
        window.location.href = `/products?category=${categoryId}`;
    }

    function addToCart(productId) {
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const existingItem = cart.find(item => item.productId === productId);

        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({ productId, quantity: 1 });
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        showNotification('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É', 'success');
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#17a2b8'};
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        `;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 300);
        }, 3000);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
        console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö...');
        loadPopularProducts();
        loadCategories();
    });
</script>
</body>
</html>